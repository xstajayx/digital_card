<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- âœ… GitHub Pages safe: use relative path -->
  <link rel="stylesheet" href="./card-base.css" />
  <link id="themeStyles" rel="stylesheet" href="" />

  <title>Card Preview</title>
</head>

<body>
  <div class="card-root" id="cardRoot">
    <div class="balloon-curtain" id="balloonCurtain">
      <div class="curtain-layer">
        <div class="curtain-balloon" style="--b:1"></div>
        <div class="curtain-balloon" style="--b:2"></div>
        <div class="curtain-balloon" style="--b:3"></div>
        <div class="curtain-balloon" style="--b:4"></div>
        <div class="curtain-balloon" style="--b:5"></div>
        <div class="curtain-balloon" style="--b:6"></div>
        <div class="curtain-balloon" style="--b:7"></div>
        <div class="curtain-balloon" style="--b:8"></div>
        <div class="curtain-balloon" style="--b:9"></div>
        <div class="curtain-balloon" style="--b:10"></div>
        <div class="curtain-balloon" style="--b:11"></div>
        <div class="curtain-balloon" style="--b:12"></div>
      </div>
    </div>

   <div class="card">
  <div class="panel top">
    <div class="headline" id="headline">Happy Day</div>
    <div class="message" id="message"></div>
    <div class="from" id="from"></div>
  </div>

  <div class="panel bottom">
    <div class="photo-slot" id="photoSlot">
      <img id="photo" alt="Uploaded" style="display:none;" />
      <div class="placeholder" id="placeholder">
        <span>Upload a photo</span>
      </div>
    </div>

    <div class="float-balloons" aria-hidden="true">
      <div class="float-balloon b1"></div>
      <div class="float-balloon b2"></div>
      <div class="float-balloon b3"></div>
    </div>
  </div>
</div>


    <div class="confetti" id="confetti">
      <span></span><span></span><span></span><span></span><span></span>
      <span></span><span></span><span></span><span></span><span></span>
    </div>

    <div class="sparkles" id="sparkles">
      <span></span><span></span><span></span><span></span>
    </div>

    <div class="watermark" id="watermark">Made with JWorldCreations</div>
  </div>

  <script>
    function setVar(k, v) {
      document.documentElement.style.setProperty(k, v);
    }

    function replay() {
      const root = document.getElementById('cardRoot');
      if (!root) return;
      root.classList.remove('play');
      void root.offsetWidth;
      root.classList.add('play');
    }

    // Called by engine/preview.js
    window.setCardData = (data) => {
      const themeStyles = document.getElementById('themeStyles');
      if (themeStyles) {
        themeStyles.href = data.themeCssHref || '';
      }

      const p = data.palette || {};
      const t = data.timing || {};

      if (p.paper) setVar('--paper', p.paper);
      if (p.ink) setVar('--ink', p.ink);
      if (p.accent) setVar('--accent', p.accent);
      if (p.accent2) setVar('--accent2', p.accent2);
      if (p.gold) setVar('--gold', p.gold);

      if (t.balloonsMs != null) setVar('--balloons-duration', `${t.balloonsMs}ms`);
      if (t.insideDelayMs != null) setVar('--inside-delay', `${t.insideDelayMs}ms`);
      if (t.headlineDelayMs != null) setVar('--headline-delay', `${t.headlineDelayMs}ms`);
      if (t.subDelayMs != null) setVar('--sub-delay', `${t.subDelayMs}ms`);
      if (t.fromDelayMs != null) setVar('--from-delay', `${t.fromDelayMs}ms`);
      if (t.fxStartMs != null) setVar('--fx-start', `${t.fxStartMs}ms`);
      if (t.fxStopMs != null) setVar('--fx-stop', `${t.fxStopMs}ms`);

      const headlineEl = document.getElementById('headline');
      const messageEl = document.getElementById('message');
      const fromEl = document.getElementById('from');
      const photoEl = document.getElementById('photo');
      const placeholderEl = document.getElementById('placeholder');

      if (headlineEl) headlineEl.innerHTML = data.headline || '';
      if (messageEl) messageEl.textContent = data.message || '';
      if (fromEl) fromEl.textContent = data.from || '';

      if (photoEl && placeholderEl) {
        if (data.photoDataUrl) {
          photoEl.src = data.photoDataUrl;
          photoEl.style.display = 'block';
          placeholderEl.style.display = 'none';
        } else {
          photoEl.removeAttribute('src');
          photoEl.style.display = 'none';
          placeholderEl.style.display = 'flex';
        }
      }

      const wm = document.getElementById('watermark');
      if (wm) wm.style.display = data.watermark ? 'block' : 'none';

      const f = data.features || {};
      const curtain = document.getElementById('balloonCurtain');
      const confetti = document.getElementById('confetti');
      const sparkles = document.getElementById('sparkles');

      if (curtain) curtain.style.display = f.balloonCurtain ? 'flex' : 'none';
      if (confetti) confetti.style.display = f.confetti ? 'block' : 'none';
      if (sparkles) sparkles.style.display = f.sparkles ? 'block' : 'none';

      replay();
    };

    window.play = replay;
    replay();
  </script>
</body>
</html>
